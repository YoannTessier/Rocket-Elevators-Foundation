<section>
    <!-- TITLE -->
    <div class="container">
        	<div class="heading-title heading-dotted text-center">
				<h2>INTERVENTION <span>FORM</span></h2>
			</div>
    </div>
    <!-- /TITLE -->

    <!-- FORM -->
        <div class="container form">
            <%= form_with(model: @intervention) do |f| %>
                <div id="customer" class="col-md-4">
                    <%= f.label "Customer" %>
                    <%= f.collection_select :customers_id, Customer.all, :id, :company_name, include_blank: true, :onchange => "updateAjax(customer);" %>
                </div>
                <div id="building" class="col-md-4">
                    <%= f.label "Building" %>
                    <%= f.collection_select :buildings_id, Building.all, :id, :id, include_blank: true, :onchange => "updateAjax(building);" %>
                </div>
                <div id="battery" class="col-md-4">
                    <%= f.label "Battery" %>
                    <%= f.collection_select :batteries_id, Battery.all, :id, :id, include_blank: true, :onchange => "updateAjax(battery);" %>
                </div>
                <div id="column" class="col-md-4">
                    <%= f.label "Column" %>
                    <%= f.collection_select :columns_id, Column.all, :id, :id, include_blank: true, :onchange => "updateAjax(column);" %>
                </div>
                <div id="elevator" class="col-md-4">
                    <%= f.label "Elevator" %>
                    <%= f.collection_select :elevators_id, Elevator.all, :id, :id, include_blank: true, :onchange => "updateAjax(elevator);" %>
                </div>

            <%end%>
        </div>
</section>
    <!-- /FORM -->


<script>

    function updateAjax(object){
        console.log("YOOOOOOOO")
        let customerField = $("#customers_id");
        let customer = $("#customers_id").val();
        let buildingField = $("#buildings_id");
        let building = $("#buildings_id").val();
        let batteryField = $("#batteries_id");
        let battery = $("#batteries_id").val();
        let columnField = $("#columns_id");
        let column = $("#columns_id").val()
        let elevatorField = $("#elevators_id");

        let _url;
        let _dictionary;
        let _key;
        let _objectId;

        switch(object) {
            case "customer":
                _url = "/find_buildings";
                _dictionary = {customer_id: customer};
                _key = "buildings";
                _objectId = "#buildings_id"
                break;
            case "building":
                _url = "/find_batteries";
                _dictionary = {building_id: building};
                _key = "batteries";
                _objectId = "#batteries_id";
                break;
            case "battery":
                _url = "/find_columns";
                _dictionary = {battery_id: battery};
                _key = "columns";
                _objectId = "#columns_id";
                break;
            case "column":
                _url = "/find_elevators";
                _dictionary = {column_id: column};
                _key = "elevators";
                _objectId = "#elevators_id";
                break;
        }
        $.ajax({
            url: _url,
            method: "GET",  
            dataType: "json",
            data: _dictionary,
            error: function (xhr, status, error) {
                console.error('AJAX Error: ' + status + error);
            },
            success: function (response) {
                console.log(response);
                objectList  = response[_key];
                updateFields(_objectId);
            }
        })
    }
             
    function updateFields(_objectId) {      
        $(_objectId).empty();
        $(_objectId).append("<option> --- SELECT --- </option>");

        for(let i = 0; i < objectList.length; i++){
            $(_objectId).append("<option value=" + objectList[i] + ">" + objectList[i] + "</option>");
        }
    };

</script>